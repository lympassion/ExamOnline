<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>登录 - Exam Online</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="/css/login.register.css">
</head>

<body class="login-body">
    <div class="container">
        <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="index.html">
            <div class="sidebar-brand-icon rotate-n-15">
                <svg t="1626928849342" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1707" width="25" height="25"><path d="M187.2 341.7L77.9 232.4c-45.8-45.8-45.8-120.8 0-166.6s120.8-45.8 166.6 0l109.3 109.3c45.8 45.8 45.8 120.8 0 166.6s-120.8 45.8-166.6 0zM838.8 341.7l109.3-109.3c45.8-45.8 45.8-120.8 0-166.6s-120.7-45.8-166.6 0L672.2 175.2c-45.8 45.8-45.8 120.8 0 166.6 45.8 45.7 120.8 45.7 166.6-0.1z" fill="" p-id="1708"></path><path d="M743.9 905.4l-140.7 15.9c-59.9 6.8-120.4 6.8-180.3 0l-140.7-15.9c-151.6 0-268.3-159.9-247.5-310.1l15.9-115c29.4-213.9 212.2-373.2 428-373.2h68.7c215.9 0 398.6 159.3 428.2 373.1l15.9 115c20.8 150.3-95.9 310.2-247.5 310.2z" fill="#FCFCFC" p-id="1709"></path><path d="M513 936.3c-30.5 0-61-1.7-91.3-5.1l-140.2-15.8c-35.3-0.1-69.7-8.4-102.3-24.6-30.8-15.4-58.6-37.2-82.6-64.7-56.2-64.6-83.2-151.3-72-232.1l15.9-115c14.7-106 67.1-202.9 147.6-273 80.5-70.2 183.7-108.8 290.5-108.8h68.7c106.8 0 210 38.6 290.5 108.8a442.92 442.92 0 0 1 147.6 272.9l15.9 115c11.2 80.8-15.8 167.5-72 232.1-24 27.6-51.8 49.4-82.6 64.7-32.6 16.3-67 24.6-102.3 24.6l-140.2 15.8c-30.2 3.5-60.7 5.2-91.2 5.2z m-34.4-819.2c-102 0-200.5 36.9-277.4 103.9-76.8 67-126.9 159.6-140.8 260.6l-15.9 115c-10.4 75.1 14.8 156 67.3 216.2 46.4 53.2 106.9 82.5 170.4 82.5h0.6l0.6 0.1 140.7 15.9c59.1 6.7 119 6.7 178.1 0l141.3-15.9h0.6c63.5 0 124-29.3 170.4-82.5 52.5-60.3 77.7-141.1 67.3-216.2l-15.9-115c-14-101-64-193.6-140.9-260.6-76.9-67-175.4-103.9-277.4-103.9h-69z" fill="#020202" p-id="1710"></path><path d="M433.4 495.1c19.4 75.4-54.2 166.4-129.6 185.8S179.7 669 160.3 593.6s26-222.8 101.4-242.2S414 419.7 433.4 495.1z" fill="" p-id="1711"></path><path d="M298.6 513.9m-79.3 0a79.3 79.3 0 1 0 158.6 0 79.3 79.3 0 1 0-158.6 0Z" fill="#FFFFFF" p-id="1712"></path><path d="M298.6 513.9m-50.9 0a50.9 50.9 0 1 0 101.8 0 50.9 50.9 0 1 0-101.8 0Z" fill="" p-id="1713"></path><path d="M315.2 500.6m-20.3 0a20.3 20.3 0 1 0 40.6 0 20.3 20.3 0 1 0-40.6 0Z" fill="#FFFFFF" p-id="1714"></path><path d="M592.6 495.1c-19.4 75.4 54.2 166.4 129.6 185.8s124.1-11.9 143.5-87.3c19.4-75.4-26-222.8-101.4-242.2S612 419.7 592.6 495.1z" fill="" p-id="1715"></path><path d="M727.4 513.9m-79.3 0a79.3 79.3 0 1 0 158.6 0 79.3 79.3 0 1 0-158.6 0Z" fill="#FFFFFF" p-id="1716"></path><path d="M727.4 513.9m-50.9 0a50.9 50.9 0 1 0 101.8 0 50.9 50.9 0 1 0-101.8 0Z" fill="" p-id="1717"></path><path d="M710.8 500.6m-20.3 0a20.3 20.3 0 1 0 40.6 0 20.3 20.3 0 1 0-40.6 0Z" fill="#FFFFFF" p-id="1718"></path><path d="M466.3 695.3a46.7 34.5 0 1 0 93.4 0 46.7 34.5 0 1 0-93.4 0Z" fill="" p-id="1719"></path><path d="M485.9 823.1c0 9.5-12.1 17.1-27.1 17.1-15 0-27.1-7.7-27.1-17.1" fill="#FCFCFC" p-id="1720"></path><path d="M458.8 850.3c-20.8 0-37.1-11.9-37.1-27.1 0-5.5 4.5-10 10-10s10 4.5 10 10c0 2.2 6.5 7.1 17.1 7.1 10.6 0 17.1-5 17.1-7.1 0-5.5 4.5-10 10-10s10 4.5 10 10c0 15.1-16.3 27.1-37.1 27.1z" fill="" p-id="1721"></path><path d="M594.3 823.1c0 9.5-12.1 17.1-27.1 17.1-15 0-27.1-7.7-27.1-17.1" fill="#FCFCFC" p-id="1722"></path><path d="M567.2 850.3c-20.8 0-37.1-11.9-37.1-27.1 0-5.5 4.5-10 10-10s10 4.5 10 10c0 2.2 6.5 7.1 17.1 7.1s17.1-5 17.1-7.1c0-5.5 4.5-10 10-10s10 4.5 10 10c0 15.1-16.3 27.1-37.1 27.1z" fill="" p-id="1723"></path><path d="M485.9 823.1c0-9.5 12.1-17.1 27.1-17.1 15 0 27.1 7.7 27.1 17.1" fill="#FCFCFC" p-id="1724"></path><path d="M550.1 823.1h-20c0-2.2-6.5-7.1-17.1-7.1-10.6 0-17.1 5-17.1 7.1h-20c0-15.2 16.3-27.1 37.1-27.1s37.1 11.9 37.1 27.1z" fill="" p-id="1725"></path></svg>
            </div>
            <div class="sidebar-brand-text mx-3"><span style="color: #2e2f37">Exam Online</span></div>
        </a>
        <br><br>
        <div class="card shadow-lg">
            <div class="card-body" style="margin-top: 20px;">
                <form class="needs-validation" novalidate>
                    <div class="input-group mb-2">
                        <label for="userId" class="col-sm-3 col-form-label"></span>用户名</span></label>
                        <div class="col-sm-9">
                            <input id="userId" name="userId" type="text" class="form-control" aria-label="userId" required>
                            <div class="invalid-feedback">请输入用户名</div>
                          </div>
                    </div>

                    <div class="input-group mb-2">
                        <label for="password" class="col-sm-3 col-form-label"></span>密码</span></label>
                        <div class="col-sm-9">
                            <input id="password" name="password" type="password" class="form-control" aria-label="password" required>
                            <div class="invalid-feedback">请输入密码</div>
                          </div>
                    </div>
                    <div class="alert alert-danger mb-2" role="alert" id="err-msg" hidden></div>
                    <br>
                    <button type="button" class="btn btn-primary btn-lg mb-2" id="login" style="width: 100%;">登录</button>
                    <p>还没有帐号？<a href="register.html">立即注册</a></p>
                </form> 
            </div>

        </div>
        
    </div>


    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
    <script src="/js/script.min.js"></script>
    <script src="/js/jquerysession.js"></script>

    <script>
        $(function(){
            
            $('#login').click(function(){
                var validArr = [1, 2, 3]    // 合法的id起始符
                var usertype = null, url = null;

                if($('#userId').val() == '')
                {
                    alert('请输入ID');
                    $('#userId').focus();
                    return;
                }  else if ($('#userId').val().length != 8 || validArr.indexOf(parseInt($('#userId').val()[0])) == -1) {
                    alert('ID不合法');
                    $('#userId').focus();
                    return;
                } else {
                    // ID合法，判断用户类型
                    if ($('#userId').val()[0] == '1') {
                        url = "/student/login";
                    } else if ($('#userId').val()[0] == '2') {
                        url = "/teacher/login";
                    } else {
                        url = "/admin/login";
                    }
                }

                if($('#password').val() == '')
                {
                    alert('请输入密码');
                    $('#password').focus();
                    return ;
                }
                
                var userId = $('#userId').val();

                var sendData={
                    "userId": userId,
                    "password": $('#password').val()
                };

                $.ajax({
                    type: "post",
                    url: "/user/login",
                    data: sendData,
                    datatype: "json",
                    success: function(resultMsg){
                        if(resultMsg.code == 0){
                            //登录成功
                            console.log(resultMsg);
                            setCookie("token", resultMsg.token);
                            $.session.set('userId', userId);
                            $.session.set('token', resultMsg.token);
                            if(userId[0] == "1") {
                                window.location.href="studentMain.html";
                            } else if (userId[0] == "2") {
                                window.location.href="teacherMain.html";
                            } else {
                                window.location.href="adminMain.html";
                            }
                            
                            //alert("欢迎:"+msg.data.userId);
                        }else{
                            //登录失败
                            alert(resultMsg.msg);
                        }
                    },
                    error: function(resultMsg){
                        alert("通信失败");
                    }
                });
            })
        });

        function setCookie(name,value){
                var Days = 30;
                var exp = new Date();
                exp.setTime(exp.getTime() + Days*24*60*60*30);
                document.cookie = name + "="+ escape (value) + ";expires=" + exp.toUTCString();
	        }

            function getCookie(name){
                var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
                if(arr=document.cookie.match(reg))
                return unescape(arr[2]);
                else
                return null;
            }

    </script>

</body>

</html>