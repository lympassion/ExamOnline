<!DOCTYPE html>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" type="text/css" href="\css\page.css" />
        <link rel="stylesheet" href="//css/bootstrap.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
        <link rel="stylesheet" href="/fonts/fontawesome-all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.css">
</head>
<body>
    <div class="page">
        <div class="container-fluid">
            <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="#">我的考试</a></li>
                  <li class="breadcrumb-item active" aria-current="page">已参加</li>
                </ol>
              </nav>
              <table class="table table-borderless" id="examListTable">
                <!--
                <thead>
                  <tr>
                    <th data-field="examName">考试名称</th>
                    <th data-field="examCourseName">学科</th>
                    <th data-field="examStartTime">开始时间</th>
                    <th data-field="examOperator">操作</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Java能力测试</td>
                    <td>Java</td>
                    <td>2021-07-10 20:00:00</td>
                    <td>
                        <a href="#" class="text-decoration-none">查看详情</a>
                    </td>
                  </tr>
                  
                  
                </tbody>
              </table>
              -->
  
        </div>

    </div>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.15.3/dist/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="/js/timeFormat.js"></script>

    <script>
        /*
        window.onload = function(){
            $.ajax({
                url: "/student/getAllEndExam",
                type: "GET",
                dataType: "json",
                success: function(resultMsg){
                    showData(resultMsg);
                },
                error: function(msg) {
                    alert("ajax连接异常：" + resultMsg.msg);
                }
            });
        };
        */

        // // 时间戳转换成日期格式
        // function formatDateFromTimestamp(timestamp) {
        //     var year = timestamp.getFullYear();
        //     var month = timestamp.getMonth()+1;
        //     var date = timestamp.getDate();
        //     var hour = timestamp.getHours();
        //     var minute = timestamp.getMinutes();
        //     var second = timestamp.getSeconds();
        //     return year + "-" + month + "-" + date + " " + hour + ":" + minute + ":" + second;
        // }

        function initTable() {  
            //先销毁表格  
            $('#examListTable').bootstrapTable('destroy');  
            //初始化表格, 动态从服务器加载数据  
            $("#examListTable").bootstrapTable({  
                method: "get", 
                url: "/student/getExamReady?sid=" + userId,
                // pagination: true, //启动分页  
                // pageSize: 1,  //每页显示的记录数  
                // pageNumber:1, //当前第几页  
                // pageList: [5, 10, 15, 20, 25],  //记录数可选列表  
                search: true,  //是否启用查询
                showRefresh: true,  //显示刷新按钮  
                columns: [{
                      field: 'examName',
                      title: '考试名称'
                  }, {
                      field: 'examCourseName',
                      title: '学科'
                  }, {
                      field: 'examStartTime',
                      title: '开始时间',
                      formatter: function(value, row, index) {
                          return formatTimeFromTimestamp(value)
                      }
                  }, {
                      field: 'examEndTime',
                      title: '停止进入时间',
                      formatter: function(value, row, index) {
                          return formatTimeFromTimestamp(value)
                      }
                  }, {
                      field: 'examOperator',
                      title: '操作',
                      formatter: addButton,
                      events: operateEvents
                  }],
                  data:[
                      {"examName":"测试1","examCourseName":"java","examStartTime":1626057000,"examEndTime":1626229800},
                      {"examName":"测试2","examCourseName":"java","examStartTime":1626143400,"examEndTime":1626229800},
                      {"examName":"测试3","examCourseName":"java","examStartTime":1626143400,"examEndTime":1626229800},
                      {"examName":"测试4","examCourseName":"java","examStartTime":1626143400,"examEndTime":1626229800},
                      {"examName":"测试5","examCourseName":"java","examStartTime":1626143400,"examEndTime":1626229800},
                      {"examName":"测试6","examCourseName":"java","examStartTime":1626143400,"examEndTime":1626229800},
                      {"examName":"测试7","examCourseName":"java","examStartTime":1626143400,"examEndTime":1626229800},
                      {"examName":"测试8","examCourseName":"java","examStartTime":1626093132,"examEndTime":1626229800},
                      {"examName":"测试9","examCourseName":"java","examStartTime":1626093132,"examEndTime":1626229800}
                  ]
   
            });  
        }

        function addButton(value, row, index) {
            var startTime = row.examStartTime;
            var endTime = row.examEndTime;
            var timeNow = Math.round(new Date() / 1000);
            // 如果时间范围合法，则添加进入考试按钮；如果时间未到则显示‘尚未开始’
            if(timeNow >= startTime && timeNow < endTime) {
                return [
                    '<button type="button" class="RoleOfA btn btn-default btn-primary btn-sm" style="margin-right:15px;">进入考试</button>'
                ].join('');
            } else if (timeNow < startTime) {
              return [
                  '<p>尚未开始</p>'
              ].join('');
            }
        }

        window.operateEvents = {
            'click .RoleOfA': function (e, value, row, index) {
                var val = row.examName;
                alert(val + '：考试页面还没写……');            
            }
        }; 
    
        $(document).ready(function () {          
            //调用函数，初始化表格  
            initTable();    
        }); 

    </script>

<style>
  #examListTable {border: none;}
</style>

</body>
</html>